—ñ–º–ø–æ—Ä—Ç  asyncio

–∑  pywebio  —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏  start_server
–≤—ñ–¥  pywebio . —ñ–º–ø–æ—Ä—Ç –≤–≤–µ–¥–µ–Ω–Ω—è  * 
–≤—ñ–¥  pywebio . –≤–∏—Ö—ñ–¥–Ω–∏–π  —ñ–º–ø–æ—Ä—Ç  *
–≤—ñ–¥  pywebio . —ñ–º–ø–æ—Ä—Ç —Å–µ—Å—ñ—ó  defer_call , —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —è–∫ session_info , run_async , run_js   

chat_msgs  = []
online_users  =  set ()

MAX_MESSAGES_COUNT  =  100

async  def  main ():
    –≥–ª–æ–±–∞–ª—å–Ω–∏–π  chat_msgs
    
    put_markdown ( "## üßä –î–æ–±—Ä–æ–≥–æ –ø–æ–±–∞–∂–∞–Ω–Ω—è –≤ –æ–Ω–ª–∞–π–Ω-—á–∞—Ç—ñ! \n –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ –¥–∞–Ω–æ–≥–æ —á–∞—Ç–∞ —É–∫–ª–∞–¥–∞—î—Ç—å—Å—è –≤ 100 —Å—Ç—Ä–æ–∫ –∫–æ–¥—É!" )

    msg_box  =  –≤–∏—Ö—ñ–¥ ()
    put_scrollable ( msg_box , height = 300 , keep_bottom = True )

    nickname  =  await  input ( "–í—ñ–π—Ç–∏ –≤ —á–∞—Ç" , –æ–±–æ–≤'—è–∑–∫–æ–≤–æ = True , placeholder = "–í–∞—à–µ —ñ–º'—è" , validate = lambda  n : "–¢–∞–∫–∏–π –Ω–∏–∫ —É–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è!"  —è–∫—â–æ  n  —É  online_users  –∞–±–æ  n  ==  'üì¢'  else  None )
    –æ–Ω–ª–∞–π–Ω_–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ . –¥–æ–¥–∞—Ç–∏ ( –ø—Å–µ–≤–¥–æ–Ω—ñ–º )

    chat_msgs . append (( 'üì¢' , f'` { –ø—Å–µ–≤–¥–æ–Ω—ñ–º } ` –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è –¥–æ —á–∞—Ç—É!' ))
    msg_box . append ( put_markdown ( f'üì¢ ` { –ø—Å–µ–≤–¥–æ–Ω—ñ–º } ` –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è –¥–æ —á–∞—Ç—É' ))

    refresh_task  =  run_async ( refresh_msg ( –ø—Å–µ–≤–¥–æ–Ω—ñ–º , msg_box ))

    –≤ —Ç–æ–π —á–∞—Å —è–∫  True :
        data  =  await  input_group ( "üí≠ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" , [
            input ( placeholder = "–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ..." , name = "msg" ),
            –¥—ñ—ó ( name = "cmd" , buttons = [ "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏" , { 'label' : "–í–∏–π—Ç–∏ –∑ —á–∞—Ç–∞" , 'type' : 'cancel' }])
        ], validate  =  lambda  m : ( 'msg' , "–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!" ) if  m [ "cmd" ] ==  "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏"  , –∞  –Ω–µ  m [ 'msg' ] else  None )

        —è–∫—â–æ  –¥–∞–Ω—ñ  –ù–µ–º–∞—î  : _
            –ø–µ—Ä–µ—Ä–≤–∞

        msg_box . append ( put_markdown ( f"` { –ø—Å–µ–≤–¥–æ–Ω—ñ–º } `: { –¥–∞–Ω—ñ [ '–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è' ] } " ))
        chat_msgs . –¥–æ–¥–∞—Ç–∏ (( –ø—Å–µ–≤–¥–æ–Ω—ñ–º , –¥–∞–Ω—ñ [ '–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è' ]))

    refresh_task . –∑–∞–∫—Ä–∏—Ç–∏ ()

    –æ–Ω–ª–∞–π–Ω_–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ . –≤–∏–¥–∞–ª–∏—Ç–∏ ( –ø—Å–µ–≤–¥–æ–Ω—ñ–º )
    —Ç–æ—Å—Ç ( "–í—ã –≤—ã—à–ª–∏ –∏–∑ —á–∞—Ç–∞!" )
    msg_box . append ( put_markdown ( f'üì¢ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ` { –ø—Å–µ–≤–¥–æ–Ω—ñ–º } ` –ø–æ–∫–∏–Ω—É–≤ —á–∞—Ç!' ))
    chat_msgs . append (( 'üì¢' , f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ` { –ø—Å–µ–≤–¥–æ–Ω—ñ–º } ` –ø–æ–∫–∏–Ω—É–≤ —á–∞—Ç!' ))

    put_buttons ([ '–ü–µ—Ä–µ–∑–∞–π—Ç–∏' ], onclick = lambda  btn : run_js ( 'window.location.reload()' ))

async  def  refresh_msg ( –ø—Å–µ–≤–¥–æ–Ω—ñ–º , msg_box ):
    –≥–ª–æ–±–∞–ª—å–Ω–∏–π  chat_msgs
    last_idx  =  len ( chat_msgs )

    –≤ —Ç–æ–π —á–∞—Å —è–∫  True :
        –æ—á—ñ–∫—É–≤–∞—Ç–∏  asyncio . —Å–ø–∞—Ç–∏ ( 1 )
        
        –¥–ª—è  m  —É  chat_msgs [ last_idx :]:
            if  m [ 0 ] !=  –ø—Å–µ–≤–¥–æ–Ω—ñ–º : # —è–∫—â–æ –Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                msg_box . append ( put_markdown ( f"` { m [ 0 ] } `: { m [ 1 ] } " ))
        
        –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó # –≤–∏–¥–∞–ª–µ–Ω–Ω—è –º–∏–Ω—É–≤
        —è–∫—â–æ  len ( chat_msgs ) >  MAX_MESSAGES_COUNT :
            chat_msgs  =  chat_msgs [ len ( chat_msgs ) //  2 :]
        
        last_idx  =  len ( chat_msgs )

if  __name__  ==  "__main__" :
    start_server ( –æ—Å–Ω–æ–≤–Ω–∏–π , debug = True , –ø–æ—Ä—Ç = 8080 , cdn = False )
